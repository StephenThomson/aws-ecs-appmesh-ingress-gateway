version: "2.4"
services:
  igw:
    build:
      context: ../
      dockerfile: Dockerfile
    image: local-igw-integration-tests-build
    container_name: igw
    ports:
      - "10000:10000"
    networks:
      - igw
    environment:
      # If you change the number of httpbin containers you will have to
      # update this variable. Note: The absence of the trailing semicolon
      # is important.
      APPLICATION_ENDPOINT: httpbin_1:80;\nserver httpbin_2:80;\nserver httpbin_3:80
    healthcheck:
      test: [ "CMD", "wget", "http://localhost:10000/nginx-health" ]
      interval: 2s
      timeout: 2s
      retries: 2
      #start_period: 1s
    cpuset: "1"
    depends_on:
      - httpbin_1
      - httpbin_2
      - httpbin_3

  httpbin_1:
    image: kennethreitz/httpbin
    container_name: httpbin_1
    networks:
      - igw

  httpbin_2:
    image: kennethreitz/httpbin
    container_name: httpbin_2
    networks:
      - igw

  httpbin_3:
    image: kennethreitz/httpbin
    container_name: httpbin_3
    networks:
      - igw

networks:
  igw:
    name: igw


